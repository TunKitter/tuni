(()=>{"use strict";var e={618:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getTemplateDialogComponent=function(){const e={name:"",description:""},t=(0,i.getComponent)(".tunkit_template",!1),n=t.querySelector(".tunkit_template_name"),o=t.querySelector(".tunkit_template_description");return{render(){r.default.DIALOG_WRAPPER.appendChild(t),t.style.display="block"},getInputNameData:()=>n.value,getInputDescriptionData:()=>o.value,getElement:()=>t,getName:()=>e.name,setName(t){e.name=t,n.value=t},getDescription:()=>e.description,setDescription(t){e.description=t,o.value=t},onClickClose(e){t.querySelector(".tunkit_close_template").onclick=()=>e()},onClickSubmit(e){t.querySelector(".tunkit_save_template").onclick=()=>e()},onClickDelete(e){t.querySelector(".tunkit_delete_template").onclick=()=>e()}}};const i=n(666),r=o(n(934))},195:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialogWithOverlayFlow=function(e,t){var n;let i=null!=(null==t?void 0:t.overlay_z_index)?(0,o.getFullOverlay)(t.overlay_z_index):null;return null==i||i.render(),null===(n=t.close_selector)||void 0===n||n.map((t=>{e.querySelector(t).addEventListener("click",(function(){var t;e.remove(),null===(t=null==i?void 0:i.getElement())||void 0===t||t.remove()}))})),{removeOverlay:()=>{var e;return null===(e=null==i?void 0:i.getElement())||void 0===e?void 0:e.remove()},removeDialog:()=>e.remove()}};const o=n(827)},879:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(433),l=i(n(500)),a=n(221),u=n(262);new MutationObserver(((e,t)=>o(void 0,void 0,void 0,(function*(){"complete"===document.readyState&&!document.querySelector("#tunkit_interactive_button")&&document.querySelector(".ytp-subtitles-button.ytp-button")&&((0,r.insertToggleIconMenu)(),yield(0,r.insertComponent)(),(0,r.insertMenuPanel)(),(0,a.handleToggleMenuSwitcherIcon)(),(0,r.handelTogglePanel)(),(0,l.default)(),(0,a.handleChangeViewPanel)(),(0,u.handleCreateTemplatePanel)(),t.disconnect())})))).observe(document,{childList:!0,subtree:!0})},433:function(e,t,n){var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),l=0;l<n.length;l++)"default"!==n[l]&&i(t,e,n[l]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.component_wrapper=void 0,t.insertToggleIconMenu=function(){const e=document.querySelector(".ytp-subtitles-button.ytp-button");if(null==e)throw new Error("Can't insert trigger button");const t=document.createElement("button");t.classList.add("ytp-button"),t.id="tunkit_interactive_button",t.innerHTML=`<img id="tunkit_svg" aria-pressed="false" class="ytp-svg-shadow" src="${(0,u._getURL)("icons/panel_icon.svg")}"/>`,e.insertAdjacentElement("afterend",t)},t.insertComponent=function(){return a(this,void 0,void 0,(function*(){yield fetch((0,u._getURL)("static/bundle.html")).then((e=>e.text())).then((function(e){const n=(0,u._getURL)("icons/");e=e.replaceAll(/{{icon\./g,n).replaceAll("}}",".svg"),t.component_wrapper.innerHTML=e,(0,c.initAfterInsertComponent)()}))}))},t.insertMenuPanel=function(){var e;null===(e=document.querySelector(".ytp-popup.ytp-settings-menu"))||void 0===e||e.insertAdjacentElement("afterend",c.default.PANEL_WRAPPER)},t.handelTogglePanel=function(){const e=document.querySelector("#tunkit_interactive_button");if(null==e)throw new Error("Can't find trigger button");e.addEventListener("click",(()=>c.default.PANEL_WRAPPER.classList.toggle("tunkit_menu_active")))};const u=n(666),c=l(n(934));t.component_wrapper=document.createElement("div")},834:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(666);t.default=class{static from(e){return{getAll:()=>chrome.runtime.sendMessage({type:"GET_ALL_TEMPLATE",youtubeID:e}),get:t=>chrome.runtime.sendMessage({type:"GET_TEMPLATE",youtubeID:e,id:t}),insert(t){const n=(0,o.randomString)();return chrome.runtime.sendMessage({type:"INSERT_TEMPLATE",youtubeID:e,id:n,data:t}).then((()=>({status:"success",id:n})))},remove:t=>chrome.runtime.sendMessage({type:"REMOVE_TEMPLATE",youtubeID:e,id:t}),update:(t,n)=>chrome.runtime.sendMessage({type:"UPDATE_TEMPLATE",youtubeID:e,id:t,data:n})}}}},500:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){navigation.addEventListener("navigate",(()=>{var e;null===(e=i.default.PANEL_WRAPPER)||void 0===e||e.classList.remove("tunkit_menu_active")}))};const i=o(n(934))},827:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFullOverlay=function(e){const t=i.default.FULL_OVERLAY.cloneNode(!0);return e&&(t.style.zIndex=String(e)),{render(){i.default.FULL_OVERLAY_WRAPPER.appendChild(t)},getElement:()=>t}};const i=o(n(934))},221:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleShowPanel=l,t.handleChangeViewPanel=function(){l(i.default.PANEL_WRAPPER,(function(e,t){if(0!=c())switch(e.dataset.tunkitPanel){case"main":t();break;case"template":if(t(),i.default.IS_GET_TEMPLATE)break;(0,r.handleLoadTemplate)(),i.default.IS_GET_TEMPLATE=!0}}))},t.showPanel=a,t.handleToggleMenuSwitcherIcon=function(){var e,t;null===(t=null===(e=i.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_toggle_interactive_video"))||void 0===t||t.addEventListener("click",(function(){u(!c())}))},t.setActivePanel=u,t.getActivePanel=c,t.setDisableItems=function(e,t,n){e.querySelectorAll(t).forEach((e=>{e.style.opacity=n?"0.5":"1"}))};const i=o(n(934)),r=n(262);function l(e,t=void 0){e.querySelectorAll("*[data-tunkit-panel]").forEach((e=>{e.addEventListener("click",(function(){void 0!==t&&t(e,(function(){a(".tunkit_panel.panel_"+e.dataset.tunkitPanel,e.dataset.tunkitType)}))}))}))}function a(e,t,n=document){var o,i,r,l;null===(i=null===(o=n.querySelector("."+t))||void 0===o?void 0:o.classList)||void 0===i||i.remove(t),null===(l=null===(r=n.querySelector(e))||void 0===r?void 0:r.classList)||void 0===l||l.add(t)}function u(e){var t,n;(null===(t=i.default.PANEL_WRAPPER)||void 0===t?void 0:t.querySelector("#tunkit_toggle_interactive_video")).setAttribute("aria-checked",e?"true":"false"),(null===(n=i.default.PANEL_WRAPPER)||void 0===n?void 0:n.querySelector(".tunkit_content")).style.opacity=e?"1":"0.5"}function c(){var e;return"true"==(null===(e=i.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_toggle_interactive_video")).getAttribute("aria-checked")}},262:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleLoadTemplate=function(){return o(this,void 0,void 0,(function*(){var e;const t=null===(e=c.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_loader.loader_template");t.style.display="block",c.default.TEMPLATE_PANEL_WRAPPER.innerHTML="";const n=yield a.default.from((0,u.getCurrentYoutubeId)()).getAll();Object.keys(n).forEach((e=>{d(e,s(),n[e])})),t.style.display="none"}))},t.getTemplateItemComponent=s,t.handleCreateTemplatePanel=function(){c.default.PANEL_WRAPPER.querySelector(".create_new_template_btn").onclick=function(){var e;const t=(0,r.getTemplateDialogComponent)();(0,l.DialogWithOverlayFlow)(t.getElement(),{close_selector:[".tunkit_close_template",".tunkit_save_template"],overlay_z_index:2201}),null===(e=t.getElement().querySelector(".tunkit_title_template_dialog"))||void 0===e||(e.innerText="Create Template"),t.getElement().querySelector(".tunkit_delete_template").remove(),t.render(),t.onClickSubmit((function(){const e={name:t.getInputNameData(),description:t.getInputDescriptionData(),timelineNotes:{}};a.default.from((0,u.getCurrentYoutubeId)()).insert(e).then((t=>{if("success"==t.status&&t.id){const n=s();d(t.id,n,e)}}))}))}};const r=n(618),l=n(195),a=i(n(834)),u=n(666),c=i(n(934));function s(){const e={name:"",total_notes:0,description:""},t=(0,u.getComponent)(".tunkit_template_panel_item",!1),n=t.querySelector(".tunkit_template_panel_item_name"),o=t.querySelector(".tunkit_template_panel_item_total_note");return{render(){c.default.TEMPLATE_PANEL_WRAPPER.appendChild(t)},getName:()=>e.name,getTotalNotes:()=>e.total_notes,getDescription:()=>e.description,getNameInputData:()=>n.textContent,getTotalNotesInputData:()=>o.textContent,setName(t){e.name=t,function(e){n.textContent=e}(t)},setDescription(t){e.description=t},setTotalNotes(t){e.total_notes=t,function(e){o.textContent=`${e} note${e>1?"s":""}`}(t)},getElement:()=>t,onCLickDetail(e){t.querySelector(".tunkit_template_icon_detail").onclick=function(t){t.stopPropagation(),e()}},onClick(e){t.onclick=()=>e()}}}function d(e,t,n){t.setName(n.name),t.setDescription(n.description),t.setTotalNotes(Object.keys(n.timelineNotes).length),t.onCLickDetail((function(){const n=(0,r.getTemplateDialogComponent)();n.setName(t.getName()),n.setDescription(t.getDescription()),n.render();const o=(0,l.DialogWithOverlayFlow)(n.getElement(),{close_selector:[".tunkit_close_template",".tunkit_save_template"],overlay_z_index:2201});n.onClickSubmit((function(){a.default.from((0,u.getCurrentYoutubeId)()).update(e,{name:n.getInputNameData(),description:n.getInputDescriptionData()}).then((e=>{"success"==e.status&&(t.setName(n.getInputNameData()),t.setDescription(n.getInputDescriptionData()),o.removeOverlay(),o.removeDialog())}))})),n.onClickDelete((()=>{confirm("Are you sure you want to delete this template?")&&a.default.from((0,u.getCurrentYoutubeId)()).remove(e).then((e=>{"success"==e.status&&(o.removeOverlay(),o.removeDialog(),t.getElement().remove())}))}))})),t.render()}},666:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._getURL=function(e){return chrome.runtime.getURL(`assets/${e}`)},t.getComponent=function(e,t=!0){const n=o.component_wrapper.querySelector(`${e}`);if(null==n)throw new Error("Can't find component");const i=n.cloneNode(!0);return 1==t&&n.remove(),i},t.randomString=function(){return"_"+(Date.now()+Math.random()+1).toString(36).replaceAll(".","")},t.getCurrentYoutubeId=function(){const e=new URLSearchParams(window.location.search).get("v");if(null==e)throw new Error("Can't get youtubeID");return e},t.getTitleYoutube=function(){var e;const t=null===(e=document.querySelector("#title > h1 > yt-formatted-string"))||void 0===e?void 0:e.textContent;if(null==t)throw new Error("Can't get youtube title");return t};const o=n(433)},934:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initAfterInsertComponent=function(){var e;i.PANEL_WRAPPER=(0,o.getComponent)(".tunkit_panel_wrapper"),i.TEMPLATE_PANEL_WRAPPER=null===(e=i.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector(".tunkit_template_wrapper"),i.FULL_OVERLAY_WRAPPER.className="tunkit_overlay_wrapper",document.body.insertAdjacentElement("afterend",i.FULL_OVERLAY_WRAPPER),i.FULL_OVERLAY.className="tunkit_overlay opened",i.FULL_OVERLAY.style.zIndex="2201",i.DIALOG_WRAPPER.className="tunkit_dialog_wrapper",document.body.insertAdjacentElement("afterend",i.DIALOG_WRAPPER)};const o=n(666),i={PANEL_WRAPPER:null,IS_GET_TEMPLATE:!1,TEMPLATE_PANEL_WRAPPER:null,FULL_OVERLAY_WRAPPER:document.createElement("div"),FULL_OVERLAY:document.createElement("tp-yt-iron-overlay-backdrop"),DIALOG_WRAPPER:document.createElement("div")};t.default=i}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(879)})();