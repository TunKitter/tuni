(()=>{"use strict";var e={462:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,o.getComponent)(".tunkit_input_tags_wrapper",!1),t=e.querySelector("#tunkit_input_type_folder"),n=e.querySelector("#tunkit_list_folder");let l=[];return e.addEventListener("click",(()=>t.focus())),t.addEventListener("keyup",(function(e){let o=t.value;"Enter"===e.key&&o.length>0&&!l.includes(o)&&(l.push(o),i(n,l,o),t.value="")})),{getElement:()=>e,setData:function(e){!function(e,t){e.querySelectorAll("li:not(#tunkit_input_type_folder_li)").forEach((e=>e.remove())),t.forEach((n=>{i(e,t,n)}))}(n,e),l=e},getData:()=>l}};const o=n(666);function i(e,t,n){const i=document.createElement("li");i.innerText=n;const l=(0,o.getComponent)(".tunkit_close_icon_input_tags_wrapper",!1);i.prepend(l),e.appendChild(i),l.addEventListener("click",(function(){t.splice(t.indexOf(n),1),i.remove()}))}},863:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getBaseTimelineDialog=function(){const e=(0,l.getComponent)(".tunkit_timeline_note.base_timeline_dialog",!1),t=(0,i.default)();(0,l.insertAdjacentElement)(e,t.getElement(),".tunkit_base_info_wrapper");const n=e.querySelector("#tunkit_timeline_note_name"),o=e.querySelector(".tunkit_input_time.time_start"),a=e.querySelector(".tunkit_input_time.time_end");return{render(){r.default.DIALOG_WRAPPER.appendChild(e),e.style.display="block"},INPUT_TAG:t,getElement:()=>e,getName:()=>n.value,getStartTime:()=>(0,l.HmsToSeconds)(o.value),getEndTime:()=>(0,l.HmsToSeconds)(a.value),setTitle(t){e.querySelector("#tunkit_title_timeline").innerText=t},setName(e){n.value=e},setStartTime(e){o.value=(0,l.secondsToHms)(String(e))},setEndTime(e){a.value=(0,l.secondsToHms)(String(e))},onClickSave(t){e.querySelector(".tunkit_save_timeline_btn").onclick=()=>t()},onClickDelete(t){e.querySelector(".delete_timeline_button").onclick=()=>t()}}};const i=o(n(462)),l=n(666),r=o(n(934))},618:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getTemplateDialogComponent=function(){const e={name:"",description:""},t=(0,i.getComponent)(".tunkit_template",!1),n=t.querySelector(".tunkit_template_name"),o=t.querySelector(".tunkit_template_description");return{render(){l.default.DIALOG_WRAPPER.appendChild(t),t.style.display="block"},getInputNameData:()=>n.value,getInputDescriptionData:()=>o.value,getElement:()=>t,getName:()=>e.name,setName(t){e.name=t,n.value=t},getDescription:()=>e.description,setDescription(t){e.description=t,o.value=t},onClickClose(e){t.querySelector(".tunkit_close_template").onclick=()=>e()},onClickSubmit(e){t.querySelector(".tunkit_save_template").onclick=()=>e()},onClickDelete(e){t.querySelector(".tunkit_delete_template").onclick=()=>e()}}};const i=n(666),l=o(n(934))},195:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialogWithOverlayFlow=function(e,t){var n;let i=null!=(null==t?void 0:t.overlay_z_index)?(0,o.getFullOverlay)(t.overlay_z_index):null;return null==i||i.render(),null===(n=t.close_selector)||void 0===n||n.map((t=>{e.querySelector(t).addEventListener("click",(function(){var t;e.remove(),null===(t=null==i?void 0:i.getElement())||void 0===t||t.remove()}))})),{removeOverlay:()=>{var e;return null===(e=null==i?void 0:i.getElement())||void 0===e?void 0:e.remove()},removeDialog:()=>e.remove()}};const o=n(827)},879:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function r(e){try{u(o.next(e))}catch(e){l(e)}}function a(e){try{u(o.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(433),r=i(n(500)),a=n(221),u=n(262);new MutationObserver(((e,t)=>o(void 0,void 0,void 0,(function*(){"complete"===document.readyState&&!document.querySelector("#tunkit_interactive_button")&&document.querySelector(".ytp-subtitles-button.ytp-button")&&((0,l.insertToggleIconMenu)(),yield(0,l.insertComponent)(),(0,l.insertMenuPanel)(),(0,a.handleToggleMenuSwitcherIcon)(),(0,l.handelTogglePanel)(),(0,r.default)(),(0,a.handleChangeViewPanel)(),(0,u.handleCreateTemplatePanel)(),t.disconnect())})))).observe(document,{childList:!0,subtree:!0})},433:function(e,t,n){var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),r=0;r<n.length;r++)"default"!==n[r]&&i(t,e,n[r]);return l(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function r(e){try{u(o.next(e))}catch(e){l(e)}}function a(e){try{u(o.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.component_wrapper=void 0,t.insertToggleIconMenu=function(){const e=document.querySelector(".ytp-subtitles-button.ytp-button");if(null==e)throw new Error("Can't insert trigger button");const t=document.createElement("button");t.classList.add("ytp-button"),t.id="tunkit_interactive_button",t.innerHTML=`<img id="tunkit_svg" aria-pressed="false" class="ytp-svg-shadow" src="${(0,u._getURL)("icons/panel_icon.svg")}"/>`,e.insertAdjacentElement("afterend",t)},t.insertComponent=function(){return a(this,void 0,void 0,(function*(){yield fetch((0,u._getURL)("static/bundle.html")).then((e=>e.text())).then((function(e){const n=(0,u._getURL)("icons/");e=e.replaceAll(/{{icon\./g,n).replaceAll("}}",".svg"),t.component_wrapper.innerHTML=e,(0,c.initAfterInsertComponent)()}))}))},t.insertMenuPanel=function(){var e;null===(e=document.querySelector(".ytp-popup.ytp-settings-menu"))||void 0===e||e.insertAdjacentElement("afterend",c.default.PANEL_WRAPPER)},t.handelTogglePanel=function(){const e=document.querySelector("#tunkit_interactive_button");if(null==e)throw new Error("Can't find trigger button");e.addEventListener("click",(()=>c.default.PANEL_WRAPPER.classList.toggle("tunkit_menu_active")))};const u=n(666),c=r(n(934));t.component_wrapper=document.createElement("div")},834:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(666);t.default=class{static from(e){return{getAll:()=>chrome.runtime.sendMessage({type:"GET_ALL_TEMPLATE",youtubeID:e}),get:t=>chrome.runtime.sendMessage({type:"GET_TEMPLATE",youtubeID:e,id:t}),insert(t){const n=(0,o.randomString)();return chrome.runtime.sendMessage({type:"INSERT_TEMPLATE",youtubeID:e,id:n,data:t}).then((()=>({status:"success",id:n})))},remove:t=>chrome.runtime.sendMessage({type:"REMOVE_TEMPLATE",youtubeID:e,id:t}),update:(t,n)=>chrome.runtime.sendMessage({type:"UPDATE_TEMPLATE",youtubeID:e,id:t,data:n})}}}},103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{}n.GETNAME={message:"Message",flashcard:"Flashcard",typing:"Typing",pointer:"Pointer"},t.default=n},500:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){navigation.addEventListener("navigate",(()=>{var e;null===(e=l.default.PANEL_WRAPPER)||void 0===e||e.classList.remove("tunkit_menu_active"),(0,i.setDisableItems)(l.default.PANEL_WRAPPER,".tunkit_disable_for_template",!0),(0,i.setCurrentTemplate)("Off"),(0,i.setCurrentTotalNotes)("Off"),(0,i.showPanel)(".tunkit_panel.panel_main","tunkit_panel_active"),l.default.IS_GET_TEMPLATE=!1,l.default.CURRENT_TEMPLATE_ID=null,l.default.FULL_OVERLAY_WRAPPER.innerHTML="",l.default.DIALOG_WRAPPER.innerHTML="",l.default.TEMPLATE_PANEL_WRAPPER.innerHTML=""}))};const i=n(221),l=o(n(934))},827:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFullOverlay=function(e){const t=i.default.FULL_OVERLAY.cloneNode(!0);return e&&(t.style.zIndex=String(e)),{render(){i.default.FULL_OVERLAY_WRAPPER.appendChild(t)},getElement:()=>t}};const i=o(n(934))},221:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleShowPanel=c,t.handleChangeViewPanel=function(){c(r.default.PANEL_WRAPPER,(function(e,t){if(0!=_())switch(e.dataset.tunkitPanel){case"main":t();break;case"template":if(t(),r.default.IS_GET_TEMPLATE)break;(0,a.handleLoadTemplate)(),r.default.IS_GET_TEMPLATE=!0;break;case"note":if(!r.default.CURRENT_TEMPLATE_ID)break;if(t(),r.default.IS_GET_TIMELINE)break;(0,u.handleLoadTimeline)(),r.default.IS_GET_TIMELINE=!0;break;case"create_message_timeline":if(!r.default.CURRENT_TEMPLATE_ID)return;!function(){const e=(0,i.getBaseTimelineDialog)();e.setTitle("Create Message Timeline"),e.setStartTime(r.default.VIDEO.currentTime),e.setEndTime(r.default.VIDEO.currentTime+5),(0,l.DialogWithOverlayFlow)(e.getElement(),{close_selector:[".tunkit_close_timeline",".tunkit_save_timeline_btn"],overlay_z_index:2201}),e.render()}()}}))},t.showPanel=s,t.handleToggleMenuSwitcherIcon=function(){var e,t;null===(t=null===(e=r.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_toggle_interactive_video"))||void 0===t||t.addEventListener("click",(function(){d(!_())}))},t.setActivePanel=d,t.getActivePanel=_,t.setDisableItems=function(e,t,n){e.querySelectorAll(t).forEach((e=>{e.style.opacity=n?"0.5":"1"}))},t.setCurrentTemplate=function(e){var t;null===(t=r.default.PANEL_WRAPPER)||void 0===t||(t.querySelector(".tunkit_current_template").textContent=e)},t.setCurrentTotalNotes=function(e){var t;null===(t=r.default.PANEL_WRAPPER)||void 0===t||(t.querySelector(".tunkit_total_notes").innerText="number"==typeof e?`${e} note${e>1?"s":""}`:e)};const i=n(863),l=n(195),r=o(n(934)),a=n(262),u=n(851);function c(e,t=void 0){e.querySelectorAll("*[data-tunkit-panel]").forEach((e=>{e.addEventListener("click",(function(){void 0!==t&&t(e,(function(){s(".tunkit_panel.panel_"+e.dataset.tunkitPanel,e.dataset.tunkitType)}))}))}))}function s(e,t,n=document){var o,i,l,r;null===(i=null===(o=n.querySelector("."+t))||void 0===o?void 0:o.classList)||void 0===i||i.remove(t),null===(r=null===(l=n.querySelector(e))||void 0===l?void 0:l.classList)||void 0===r||r.add(t)}function d(e){var t,n;(null===(t=r.default.PANEL_WRAPPER)||void 0===t?void 0:t.querySelector("#tunkit_toggle_interactive_video")).setAttribute("aria-checked",e?"true":"false"),(null===(n=r.default.PANEL_WRAPPER)||void 0===n?void 0:n.querySelector(".tunkit_content")).style.opacity=e?"1":"0.5"}function _(){var e;return"true"==(null===(e=r.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_toggle_interactive_video")).getAttribute("aria-checked")}},262:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function r(e){try{u(o.next(e))}catch(e){l(e)}}function a(e){try{u(o.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleLoadTemplate=function(){return o(this,void 0,void 0,(function*(){var e;const t=null===(e=c.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_loader.loader_template");t.style.display="block",c.default.TEMPLATE_PANEL_WRAPPER.innerHTML="";const n=yield a.default.from((0,u.getCurrentYoutubeId)()).getAll();Object.keys(n).forEach((e=>{const t=d();_(e,t,n[e]),t.render()})),t.style.display="none"}))},t.getTemplateItemComponent=d,t.handleCreateTemplatePanel=function(){c.default.PANEL_WRAPPER.querySelector(".create_new_template_btn").onclick=function(){var e;const t=(0,l.getTemplateDialogComponent)();(0,r.DialogWithOverlayFlow)(t.getElement(),{close_selector:[".tunkit_close_template",".tunkit_save_template"],overlay_z_index:2201}),null===(e=t.getElement().querySelector(".tunkit_title_template_dialog"))||void 0===e||(e.innerText="Create Template"),t.getElement().querySelector(".tunkit_delete_template").remove(),t.render(),t.onClickSubmit((function(){const e={name:t.getInputNameData(),description:t.getInputDescriptionData(),timelineNotes:{}};a.default.from((0,u.getCurrentYoutubeId)()).insert(e).then((t=>{if("success"==t.status&&t.id){const n=d();_(t.id,n,e),n.getElement().querySelector(".ytp-menuitem-label").innerHTML+=' <sup class="tunkit_new_template">new</sup>',n.getElement().addEventListener("click",(function(){n.setName(e.name)}),{once:!0}),c.default.TEMPLATE_PANEL_WRAPPER.prepend(n.getElement())}}))}))}};const l=n(618),r=n(195),a=i(n(834)),u=n(666),c=i(n(934)),s=n(221);function d(){const e={name:"",timelineNotes:{},description:""},t=(0,u.getComponent)(".tunkit_template_panel_item",!1),n=t.querySelector(".tunkit_template_panel_item_name"),o=t.querySelector(".tunkit_template_panel_item_total_note");return{render(){c.default.TEMPLATE_PANEL_WRAPPER.appendChild(t)},getName:()=>e.name,getTimelineNotes:()=>e.timelineNotes,getDescription:()=>e.description,getNameInputData:()=>n.textContent,setName(t){e.name=t,function(e){n.textContent=e}(t)},setDescription(t){e.description=t},setTimelineNote(t){e.timelineNotes=t,function(){const t=Object.keys(e.timelineNotes).length;o.textContent=`${t} note${t>1?"s":""}`}()},getElement:()=>t,onClickDetail(e){t.querySelector(".tunkit_template_icon_detail").onclick=function(t){t.stopPropagation(),e()}},onClick(e){t.onclick=()=>e()}}}function _(e,t,n){t.setName(n.name),t.setDescription(n.description),t.setTimelineNote(n.timelineNotes),t.onClickDetail((function(){const n=(0,l.getTemplateDialogComponent)();n.setName(t.getName()),n.setDescription(t.getDescription()),n.render();const o=(0,r.DialogWithOverlayFlow)(n.getElement(),{close_selector:[".tunkit_close_template",".tunkit_save_template"],overlay_z_index:2201});n.onClickSubmit((function(){a.default.from((0,u.getCurrentYoutubeId)()).update(e,{name:n.getInputNameData(),description:n.getInputDescriptionData()}).then((i=>{"success"==i.status&&(t.setName(n.getInputNameData()),t.setDescription(n.getInputDescriptionData()),c.default.CURRENT_TEMPLATE_ID==e&&(0,s.setCurrentTemplate)(n.getInputNameData()),o.removeOverlay(),o.removeDialog())}))})),n.onClickDelete((()=>{c.default.CURRENT_TEMPLATE_ID!=e?confirm("Are you sure you want to delete this template?")&&a.default.from((0,u.getCurrentYoutubeId)()).remove(e).then((e=>{"success"==e.status&&(o.removeOverlay(),o.removeDialog(),t.getElement().remove())})):alert("Please select another template before deleting")}))})),t.onClick((function(){var n,o,i;null===(i=null===(o=null===(n=c.default.PANEL_WRAPPER)||void 0===n?void 0:n.querySelector(".tunkit_template_panel_item_selected"))||void 0===o?void 0:o.classList)||void 0===i||i.remove("tunkit_template_panel_item_selected"),t.getElement().classList.add("tunkit_template_panel_item_selected"),c.default.CURRENT_TEMPLATE_ID=e,(0,s.setCurrentTemplate)(t.getName()),(0,s.setCurrentTotalNotes)(Object.keys(t.getTimelineNotes()).length),(0,s.showPanel)(".tunkit_panel.panel_main","tunkit_panel_active"),(0,s.setDisableItems)(c.default.PANEL_WRAPPER,".tunkit_disable_for_template",!1),c.default.CURRENT_TEMPLATE_PANEL_ITEM=t}))}},851:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleLoadTimeline=function(){var e;const t=null===(e=r.default.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector("#tunkit_loader.loader_note");t.style.display="block",r.default.TIMELINE_PANEL_WRAPPER.innerHTML="",Object.keys(r.default.CURRENT_TEMPLATE_PANEL_ITEM.getTimelineNotes()).forEach((e=>{console.log(e)})),t.style.display="none"},t.getTimelinePanelItem=function(){const e=(0,l.getComponent)(".tunkit_timeline_panel_item"),t=e.querySelector(".timeline_panel_item_time_text"),n=e.querySelector(".timeline_panel_item_name"),o=e.querySelector(".timeline_panel_item_type");return{render(){var t;null===(t=r.default.TIMELINE_PANEL_WRAPPER)||void 0===t||t.appendChild(e)},setTimelineText(e,n){const o=`${(0,l.secondsToHms)(String(e))} — ${(0,l.secondsToHms)(String(n))}`;t.textContent=o},setName(e){n.textContent=e},setType(e){o.textContent=i.default.GETNAME[e]}}};const i=o(n(103)),l=n(666),r=o(n(934))},666:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._getURL=function(e){return chrome.runtime.getURL(`assets/${e}`)},t.getComponent=function(e,t=!0){const n=o.component_wrapper.querySelector(`${e}`);if(null==n)throw new Error("Can't find component");const i=n.cloneNode(!0);return 1==t&&n.remove(),i},t.randomString=function(){return"_"+(Date.now()+Math.random()+1).toString(36).replaceAll(".","")},t.getCurrentYoutubeId=function(){const e=new URLSearchParams(window.location.search).get("v");if(null==e)throw new Error("Can't get youtubeID");return e},t.getTitleYoutube=function(){var e;const t=null===(e=document.querySelector("#title > h1 > yt-formatted-string"))||void 0===e?void 0:e.textContent;if(null==t)throw new Error("Can't get youtube title");return t},t.HmsToSeconds=function(e){let t=e.split(":");return 3!=t.length?60*parseInt(t[0])+parseInt(t[1]):3600*parseInt(t[0])+60*parseInt(t[1])+parseInt(t[2])},t.secondsToHms=function(e){let t=parseInt(e,10),n=Math.floor(t/3600),o=Math.floor((t-3600*n)/60),i=t-3600*n-60*o;return n<10?n="0"+n+":":n+=":",o<10&&(o="0"+o),i<10&&(i="0"+i),n+o+":"+i},t.insertAdjacentElement=function(e,t,n){const o=e.querySelector(n);if(null==o)throw new Error("The element does not exists");o.insertAdjacentElement("afterend",t)};const o=n(433)},934:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initAfterInsertComponent=function(){var e;if(i.PANEL_WRAPPER=(0,o.getComponent)(".tunkit_panel_wrapper"),i.TEMPLATE_PANEL_WRAPPER=null===(e=i.PANEL_WRAPPER)||void 0===e?void 0:e.querySelector(".tunkit_template_wrapper"),i.TIMELINE_PANEL_WRAPPER=i.PANEL_WRAPPER.querySelector(".tunkit_body_note"),i.FULL_OVERLAY_WRAPPER.className="tunkit_overlay_wrapper",document.body.insertAdjacentElement("afterend",i.FULL_OVERLAY_WRAPPER),i.FULL_OVERLAY.className="tunkit_overlay opened",i.FULL_OVERLAY.style.zIndex="2201",i.DIALOG_WRAPPER.className="tunkit_dialog_wrapper",document.body.insertAdjacentElement("afterend",i.DIALOG_WRAPPER),i.VIDEO=document.querySelector("video"),null==i.VIDEO)throw new Error("Can not find video element")};const o=n(666),i={PANEL_WRAPPER:null,IS_GET_TEMPLATE:!1,IS_GET_TIMELINE:!1,TEMPLATE_PANEL_WRAPPER:null,TIMELINE_PANEL_WRAPPER:null,FULL_OVERLAY_WRAPPER:document.createElement("div"),FULL_OVERLAY:document.createElement("tp-yt-iron-overlay-backdrop"),DIALOG_WRAPPER:document.createElement("div"),CURRENT_TEMPLATE_ID:null,CURRENT_TEMPLATE_PANEL_ITEM:null,VIDEO:null};t.default=i}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var l=t[o]={exports:{}};return e[o].call(l.exports,l,l.exports,n),l.exports}(879)})();